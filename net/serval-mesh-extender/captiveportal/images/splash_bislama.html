<html>
<head>
    <title>Serval Mesh Extender</title>
    <meta HTTP-EQUIV="Pragma" CONTENT="no-cache">
    <link href="style.css" type="text/css" rel="stylesheet"></link>
</head>
<body>
    <div id="flags">
        <div class="flag">
            <a href="splash_bislama.html">
                <img src="flag_vanuatu.png"/>
            </a>
        </div>
        <div class="flag">
            <a href="splash_french.html">
                <img src="flag_france.png"/>
            </a>
        </div>
        <div class="flag">
            <a href="imagesdir/../splash.html">
                <img src="flag_england.png"/>
            </a>
        </div>
    </div>
    <div id="header">
        <img src="serval_logo.png"/ id="logo">
        <h1>Welkam lo Serval Mesh Extenda</h1>
        <div id="description">
            <p>
              Hemia emi wan experimental divaes we i save helpem yu comuniket wetem olpipol iven taem i nogat celula netwok. Blo usum seves ya, yu mas instolem Serval Mesh i ko lo fon blo yu, blo save toktok wetem ol pipol. Yu wantem toktok wetem. Blo instolem, folem ol steps lo page ia.  
            </p>
            <p>
	      From oli stap wok lo hem yet, hem i no depen tumas olsem ol netwok bio ol fon. Blo usim app ia, bae app ia i tekem taem blo yu sendem mesej blo yu i ko lo nara man.
            </p>
        </div>
    </div>

    <div id="content">
        <p>
	  Taem i finis, clik long ples yia blong karem instolasien proceja
        </p>
        <p>
            http://servalmesh.au
        </p>
        <p>
	    Once emi finis, presdem button yia blong karem instolasien proceja:
	    
            <a id="linkAndroidVersion" href="#"> 
                <button class="width-button">Proceja instolasien</button>
            </a> 
         If the button above doesn't work, you can download the Android App <a href="/images/ServalChat.apk">here</a>.
     
        </p>

        <div id="neighbours">
            <h2>Mesh Extenda we oli stap kolosap:</h2>
            <lu id="neighbours-list">
            </lu>
        </div>
        <div id="transfers">
            <h2>Transfea list</h2>
            <lu id="transfers-list">
            </lu>
        </div>
        <div id="links">
            <a id="linkDNAStatus" href="#"> 
                Diagnostic
            </a> 
            <!-- <a id="linkLBARDStatus" href="#"> 
                <button class="width-button">Serval LBARD Status</button>
            </a>  -->      
        </div>
        
    </div>
    <div id="footer">
        <p>
	  Spos yu gat eni question aboutem system ia, plis contactem numba yia +678 7711139 or sendem email igo lo paul.gardner-stephen@flinders.edu.au.
        </p>
    </div>
</body>
<script>
    //Getting the neighbours list
    window.setInterval(function(){          
        var neighboursList = document.getElementById("neighbours-list");
        var transfersList = document.getElementById("transfers-list");  

        //Removing every previous children from the list
        while(neighboursList.firstChild){
            neighboursList.removeChild(neighboursList.firstChild);
        }

        while(transfersList.firstChild){
            transfersList.removeChild(transfersList.firstChild);
        }

        //Fetch the json file
        window.fetch( window.location.protocol + '//' + window.location.hostname + ':21506/status.json')
        .then(res => res.json())
        .then(resJson => {
            console.log(resJson);
            var responseNeighbours = resJson["neighbours"];

            var responseTransfers = resJson["transfers"];

            //insert in html
            var neighboursList = document.getElementById("neighbours-list");
            for(var i=0; i<responseNeighbours.length; i++){
                var li = document.createElement("li");
                var lastTime = responseNeighbours[i]["time-since-last"];
                if(lastTime <= 3)
                    li.style.color = 'green';
                else{
                    if(lastTime <= 10)
                        li.style.color = 'orange';
                    else
                        li.style.color = 'red';
                }

                li.innerHTML = responseNeighbours[i]["id"] + ': ' + responseNeighbours[i]["time-since-last"]+'s';
                neighboursList.appendChild(li);
            }

            var transfersList = document.getElementById("transfers-list");
            for(i=0; i<responseTransfers.length; i++){
                var li = document.createElement("li");
                li.innerHTML = responseTransfers[i]["id"]+ ': ' + responseTransfers[i]["version"] + ': ' + responseTransfers[i]["progress"];
                transfersList.appendChild(li);
            }
        })
        .catch(err => console.log(err));
    }, 5000); 

    //Getting android version from the user Agent
    /*var ua = navigator.userAgent;             
    if(ua.indexOf("Android") >= 0)                   
    {                                   
        //Regex to get the android version            
        var regex = /Android\s+([\d\.]+)/;
        var androidVersion = regex.exec(ua)[1].split(".")[0];
        // document.getElementById("androidVersion").innerHTML = androidVersion;
        if(androidVersion>5)
            document.getElementById("linkAndroidVersion").href = "$imagesdir/Android"+androidVersion+".html";
        else
            document.getElementById("linkAndroidVersion").href = "$imagesdir/Android5.html";
    }           */
    document.getElementById("linkAndroidVersion").href = "Android7_bislama.html";


    //DNA Status link
    document.getElementById("linkDNAStatus").href = window.location.protocol + '//' + window.location.hostname + ':4110/';

    //LBARD Status link
    // document.getElementById("linkLBARDStatus").href = window.location.protocol + '//' + window.location.hostname + ':21506/';
</script>
</html>
